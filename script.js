const data = {
    "Resisting Arrest": {
      "class": "MISDEMEANOR A",
      "time": "200-300",
      "abbreviations": ["ra", "resist", "resar", "resisting"]
    },
    "Evasion": {
      "class": "MISDEMEANOR A",
      "time": "400-500",
      "abbreviations": ["ev", "running"]
    },
    "Failure to Comply": {
      "class": "MISDEMEANOR B",
      "time": "300-500",
      "abbreviations": ["ftc", "comply", "failure"]
    },
    "Impersonation": {
        "class": "MISDEMEANOR A",
        "time": "700-700",
        "abbreviations": ["fake"]
    },
    "Misuse of Emergency Services": {
        "class": "MISDEMEANOR A",
        "time": "400-900",
        "abbreviations": ["911", "call"]
    },
    "Identification Presentation": {
        "class": "MISDEMEANOR B",
        "time": "300-420",
        "abbreviations": ["id", "give"]
    },
    "Jailbreak": {
        "class": "FELONY C",
        "time": "600-600",
        "abbreviations": ["prison", "break"]
    },
    "Interfering with a Public Service Employee": {
        "class": "MISDEMEANOR B",
        "time": "550-550",
        "abbreviations": [""]
    },
    "Felony Evasion": {
        "class": "FELONY B",
        "time": "500-600",
        "abbreviations": ["fe"]
    },
    "Unlawful Practice of Medical or Healing Art": {
        "class": "MISDEMEANOR B",
        "time": "500-500",
        "abbreviations": [""]
    },
    "1st Degree Murder": {
        "class": "FELONY A",
        "time": "900-900",
        "abbreviations": ["1dm", "one", "first"]
    },
    "2nd Degree Murder": {
        "class": "FELONY A",
        "time": "900-900",
        "abbreviations": ["2dm", "two", "second"]
    },
    "Manslaughter": {
        "class": "FELONY B",
        "time": "900-900",
        "abbreviations": ["murder"]
    },
    "Negligent Homicide": {
        "class": "FELONY C",
        "time": "900-900",
        "abbreviations": ["homocide"]
    },
    "Attempted Murder": {
        "class": "FELONY B",
        "time": "700-700",
        "abbreviations": [""]
    },
    "Assault": {
        "class": "MISDEMEANOR C",
        "time": "300-300",
        "abbreviations": [""]
    },
    "Assault with a Deadly Weapon": {
        "class": "FELONY C",
        "time": "600-600",
        "abbreviations": ["awadw"]
    },
    "Battery": {
        "class": "MISDEMEANOR A",
        "time": "420-420",
        "abbreviations": [""]
    },
    "Kidnapping": {
        "class": "FELONY B",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Robbery": {
        "class": "FELONY C",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Armed Robbery": {
        "class": "FELONY B",
        "time": "780-780",
        "abbreviations": [""]
    },
    "Stalking": {
        "class": "MISDEMEANOR C",
        "time": "420-420",
        "abbreviations": [""]
    },
    "Trafficking": {
        "class": "FELONY A",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Armed Robbery": {
        "class": "FELONY B",
        "time": "780-780",
        "abbreviations": [""]
    },
    "Medical Malpractice": {
        "class": "FELONY C",
        "time": "500-500",
        "abbreviations": [""]
    },
    "Arson": {
        "class": "FELONY B",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Theft": {
        "class": "MISDEMEANOR B",
        "time": "420-420",
        "abbreviations": [""]
    },
    "Destroying Property": {
        "class": "MISDEMEANOR A",
        "time": "480-480",
        "abbreviations": [""]
    },
    "Destroying Government Property": {
        "class": "FELONY C",
        "time": "540-540",
        "abbreviations": [""]
    },
    "Vehicular Assault": {
        "class": "FELONY C",
        "time": "680-680",
        "abbreviations": [""]
    },
    "Grand Theft Auto": {
        "class": "FELONY C",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Bank Robbery": {
        "class": "FELONY B",
        "time": "900",
        "abbreviations": [""]
    },
    "Trespassing": {
        "class": "FELONY C",
        "time": "300-300",
        "abbreviations": [""]
    },
    "Loitering": {
        "class": "MISDEMEANOR C",
        "time": "200-200",
        "abbreviations": [""]
    },
    "Trespassing on Private Property": {
        "class": "MISDEMEANOR B",
        "time": "250-250",
        "abbreviations": [""]
    },
    "Burglary": {
        "class": "FELONY C",
        "time": "650-650",
        "abbreviations": [""]
    },
    "Criminal Threats": {
        "class": "MISDEMEANOR A",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Extortion": {
        "class": "FELONY B",
        "time": "720-720",
        "abbreviations": [""]
    },
    "Hit & Run": {
        "class": "MISDEMEANOR A",
        "time": "800-800",
        "abbreviations": ["hit and run"]
    },
    "Disorderly Conduct": {
        "class": "MISDEMEANOR C",
        "time": "300-300",
        "abbreviations": [""]
    },
    "False Imprisonment": {
        "class": "FELONY B",
        "time": "840-840",
        "abbreviations": [""]
    },
    "Solicitation to Commit a Crime": {
        "class": "MISDEMEANOR B",
        "time": "300-500",
        "abbreviations": [""]
    },
    "Animal Cruelty": {
        "class": "MISDEMEANOR A",
        "time": "400-600",
        "abbreviations": [""]
    },
    "Aviation Violation": {
        "class": "FELONY C",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Driving with an Unregistered License Plate": {
        "class": "MISDEMEANOR C",
        "time": "120-200",
        "abbreviations": [""]
    },
    "Possession of Dirty Money": {
        "class": "FELONY B",
        "time": "500-500",
        "abbreviations": ["dirty"]
    },
    "Possession of a USB Firewall": {
        "class": "MISDEMEANOR A",
        "time": "450-450",
        "abbreviations": ["USB"]
    },
    "Impersonation of a Business Employee": {
        "class": "MISDEMEANOR A",
        "time": "350-350",
        "abbreviations": [""]
    },
    "Crimes on the Postal Service": {
        "class": "MISDEMEANOR B",
        "time": "350-350",
        "abbreviations": [""]
    },
    "Possessing or Using Breaching Tools": {
        "class": "FELONY C",
        "time": "500-500",
        "abbreviations": [""]
    },
    "Injury Fraud": {
        "class": "MISDEMEANOR C",
        "time": "300-300",
        "abbreviations": [""]
    },
    "Injury Fraud": {
        "class": "MISDEMEANOR C",
        "time": "300-300",
        "abbreviations": [""]
    },
    "Unlawful Possession of a Firearm": {
        "class": "FELONY C",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Criminal Misuse of a Firearm": {
        "class": "FELONY C",
        "time": "700-700",
        "abbreviations": [""]
    },
    "Negligent Misuse of a Firearm": {
        "class": "FELONY C",
        "time": "550-550",
        "abbreviations": [""]
    },
    "Unlawfully Brandishing a Firearm": {
        "class": "MISDEMEANOR A",
        "time": "470-470",
        "abbreviations": [""]
    },
    "Unlawful Distribution of a Firearm": {
        "class": "FELONY B",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Obstruction of Justice": {
        "class": "MISDEMEANOR A",
        "time": "100-300",
        "abbreviations": [""]
    },
    "Evidence": {
        "class": "FELONY B",
        "time": "900",
        "abbreviations": [""]
    },
    "Insurrection": {
        "class": "FELONY A",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Corruption": {
        "class": "MISDEMEANOR A",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Felony Corruption": {
        "class": "FELONY B",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Bribery": {
        "class": "FELONY C",
        "time": "660-660",
        "abbreviations": [""]
    },
    "Terror": {
        "class": "FELONY A",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Unlawful Assembly": {
        "class": "MISDEMEANOR A",
        "time": "300-300",
        "abbreviations": [""]
    },
    "Rioting": {
        "class": "FELONY B",
        "time": "650-650",
        "abbreviations": [""]
    },
    "Unlawful Possession of Classified Information": {
        "class": "MISDEMEANOR A",
        "time": "500-500",
        "abbreviations": [""]
    },
    "Violating State Sovereignty": {
        "class": "FELONY A",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Reckless Boating": {
        "class": "MISDEMEANOR C",
        "time": "200-200",
        "abbreviations": [""]
    },
    "Maritime Piracy": {
        "class": "FELONY B",
        "time": "900-900",
        "abbreviations": [""]
    },
    "Battery on a Police Officer": {
        "class": "FELONY C",
        "time": "500-500",
        "abbreviations": [""]
    },
    "Obstruction of a Tow": {
        "class": "MISDEMEANOR B",
        "time": "250-600",
        "abbreviations": [""]
    },
    "Misuse of Public Office": {
        "class": "MISDEMEANOR B",
        "time": "600-600",
        "abbreviations": [""]
    },
    "Contempt of Prominence Council": {
        "class": "MISDEMEANOR A",
        "time": "450-450",
        "abbreviations": [""]
    }
  };

const addedCharges = [];


function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
}

function updateAddedCharges() {
    const labelContainer = document.querySelector('.label-container');
    labelContainer.innerHTML = '<h3>Added Charges</h3>';
    let total = 0;
    addedCharges.forEach((charge, index) => {
        const addedChargeContainer = document.createElement('div');
        addedChargeContainer.classList.add('added-charge-container');

        const addedChargeText = document.createElement('span');
        addedChargeText.textContent = `${charge.name}, Time: ${charge.time}`;
        addedChargeContainer.appendChild(addedChargeText);

        addedChargeContainer.appendChild(document.createTextNode(' '));

        const removeChargeButton = document.createElement('button');
        removeChargeButton.textContent = 'Remove Charge';
        removeChargeButton.classList.add('remove-charge-button', 'small-button');
        removeChargeButton.addEventListener('click', () => {
            addedCharges.splice(index, 1);
            updateAddedCharges();
        });
        addedChargeContainer.appendChild(removeChargeButton);

        labelContainer.appendChild(addedChargeContainer);

        total += parseInt(charge.time);

        labelContainer.appendChild(document.createElement('br'));
    });
    const totalTime = Math.min(total, 900);
    const totalTimeText = document.createElement('p');
    totalTimeText.textContent = `Total time: ${totalTime}`;
    totalTimeText.classList.add('total-time-label');
    labelContainer.appendChild(totalTimeText);
}

searchInput.addEventListener("input", () => {
    const searchTerm = searchInput.value.trim().toLowerCase();

    if (searchTerm === "") {
        searchResults.innerHTML = "";
        return;
    }

    const results = Object.keys(data).filter((charge) =>
        charge.toLowerCase().includes(searchTerm)
    );

    if (results.length === 0) {
        searchResults.innerHTML = '<p>No results found.</p>';
    } else {
        searchResults.innerHTML = '';
        if (document.getElementById("searchContainer").classList.contains("open")) {
            const limitedResults = results.slice(0, 7);
            
            limitedResults.forEach((charge) => {
                if (!addedCharges.some((addedCharge) => addedCharge.name === charge)) {
                    const truncatedCharge = charge.length > 23 ? charge.slice(0, 22) + "." : charge;
                    const chargeData = data[charge];
                    const chargeBox = document.createElement('div');
                    chargeBox.classList.add('charge-box');
                    chargeBox.innerHTML = `
                        <div class="charge-info">
                            <h3 class="charge-name">${truncatedCharge}</h3>
                            <p><strong>Class:</strong></p>
                            <p>${chargeData.class}</p>
                            <div>
                                <p><strong>Time:</strong></p>
                                <input type="text" class="charge-time" placeholder="${chargeData.time}" ${chargeData.time.includes('-') ? '' : 'readonly'}>
                            </div>
                        </div>
                        <button class="add-charge" ${chargeData.time.includes('-') ? '' : 'disabled'}>Add Charge</button>
                    `;
                    searchResults.appendChild(chargeBox);

                    chargeBox.querySelector('.add-charge').addEventListener('click', () => {
                        const chargeName = charge;
                        const chargeTimeInput = chargeBox.querySelector('.charge-time');
                        let chargeTime = chargeData.time.includes('-') ? chargeData.time.split("-")[1] : chargeData.time;
                        if (chargeTimeInput.value.trim() !== '') {
                            chargeTime = Math.max(Math.min(parseInt(chargeTimeInput.value.trim()), parseInt(chargeData.time.split("-")[1])), parseInt(chargeData.time.split("-")[0]));
                        }
                        addedCharges.push({ name: chargeName, time: chargeTime });
                        updateAddedCharges();
                        chargeBox.querySelector('.add-charge').disabled = true;
                    });
                }
            });
        }
    }
});

searchResults.addEventListener('input', (event) => {
    const target = event.target;
    if (target && target.classList.contains('charge-time')) {
        target.value = target.value.replace(/\D/g, '');
    }
});

document.getElementById("submitButton").addEventListener("click", () => {
});

document.getElementById("copyLOVIDButton").addEventListener("click", () => {
    const copiedText = addedCharges.map(charge => charge.name.toUpperCase()).join(', ');
    copyToClipboard(copiedText);
    console.log('LOVID copied:', copiedText);
});

document.getElementById("copyTimeButton").addEventListener("click", () => {
    const totalTime = Math.min(addedCharges.reduce((acc, charge) => acc + parseInt(charge.time), 0), 900);
    const copiedText = `${totalTime}`;
    copyToClipboard(copiedText);
    console.log('Time copied:', copiedText);
});
